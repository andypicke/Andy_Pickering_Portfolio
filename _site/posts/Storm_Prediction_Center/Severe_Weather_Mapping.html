<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2023-06-29">
<title>Andy Pickering - Mapping Severe Thunderstorm Outlook in R using Leaflet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile2.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="../../site_libs/jquery-1.12.4/jquery.min.js"></script><link href="../../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-1.3.1/leaflet.js"></script><link href="../../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../../site_libs/proj4-2.6.2/proj4.min.js"></script><script src="../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-binding-2.1.2/leaflet.js"></script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Andy Pickering</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/andypicke/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/andypicke/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/andypicke" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Mapping Severe Thunderstorm Outlook in R using Leaflet</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">weather</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">visualization</div>
                <div class="quarto-category">mapping</div>
                <div class="quarto-category">geospatial</div>
                <div class="quarto-category">leaflet</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 29, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">July 6, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="introduction" class="level1"><h1>Introduction</h1>
<p>Living on the Colorado front range in summer means dealing with a chance of thunderstorms almost every afternoon, some of which can become severe.</p>
<p>In this post I’ll go over how I mapped the severe thunderstorm risk outlook from the <a href="https://www.spc.noaa.gov/misc/aboutus.html">NOAA Storm Prediction Center</a> , using R and leaflet.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="data" class="level1"><h1>Data</h1>
<p>The day 1 (ie today) severe thunderstorm risk (<a href="https://www.spc.noaa.gov/misc/about.html">Convective Outlook</a>) can be found at the website: <a href="https://www.spc.noaa.gov/products/outlook/day1otlk.html">NOAA Storm Prediction Center</a> . This website provides a map where you can toggle a bunch of layers on/off, but you cannot zoom in/out to get a more detailed view of where the warning areas fall relative to other non-major cities. Depending on where the risk falls, it can sometimes be difficult to tell exactly where the boundaries are, or what category your home town is in. My goal was to try to view the data in an interactive map where I can zoom in/out and see more detail. There are 2 ways of doing this:</p>
<ol type="1">
<li><p>View the data in Google Earth: Above the map there is an icon you can click to download a kmz file that can be opened in Google Earth.</p></li>
<li><p>Download the data as shapefiles (a link is provided above the map next to the kml download) and process them into a map.</p></li>
</ol>
<p>In this post I am focusing on working with the shapefiles and creating an interactive map using R and leaflet.</p>
<section id="downloading-the-data" class="level2"><h2 class="anchored" data-anchor-id="downloading-the-data">Downloading the data</h2>
<p>The shapefiles can be downloaded manually by clicking the link on the website, but the link changes whenever the forecast is updated. I wanted to do this in a more programmatic way and be able to automatically find the link for the latest forecast without having to manually copy and paste the link each time I run it. I experimented with using the <a href="https://rvest.tidyverse.org/articles/selectorgadget.html">SelectorGadget</a> to isolate the link, but found it easier to create a list of all the links in the page using the <em>rvest</em> <span class="citation" data-cites="rvest">(<a href="#ref-rvest" role="doc-biblioref">Wickham 2022</a>)</span> package and then find the link containing the shapefile (ends in <em>.shp.zip</em>).</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.spc.noaa.gov"</span></span>
<span></span>
<span></span>
<span><span class="co"># Define a function to make a list of all links on a webpage</span></span>
<span><span class="va">get_all_links</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">page_url</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># read the html from the website for day 1 outlook</span></span>
<span>  <span class="va">html</span> <span class="op">&lt;-</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">page_url</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># create a list of all the hyperlinks on the website</span></span>
<span>  <span class="va">links</span> <span class="op">&lt;-</span> <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_attr.html">html_attr</a></span><span class="op">(</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="va">html</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="st">"href"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu">get_all_links</span><span class="op">(</span>page_url<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">base_url</span>,<span class="st">"/products/outlook/day1otlk.html"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find the link for the shapefile (they only one that ends in 'shp.zip') </span></span>
<span><span class="va">shp_link</span> <span class="op">&lt;-</span> <span class="va">links</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_ends</a></span><span class="op">(</span><span class="va">links</span>,<span class="st">'shp.zip'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">shp_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">base_url</span>,<span class="va">shp_link</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'The latest shapefile as of '</span>,<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">' is '</span>,<span class="va">shp_url</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "The latest shapefile as of  2023-07-06 10:20:49  is  https://www.spc.noaa.gov/products/outlook/archive/2023/day1otlk_20230706_1300-shp.zip"</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filename of shapefile</span></span>
<span><span class="va">shp_fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">shp_url</span><span class="op">)</span></span>
<span><span class="co">#print(shp_fname)</span></span>
<span></span>
<span><span class="co"># base filename (remove *-shp.zip*) to use to load files later</span></span>
<span><span class="va">basefname</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">shp_fname</span>,<span class="st">"-shp.zip"</span><span class="op">)</span></span>
<span><span class="co">#print(basefname)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br>
Now that we have the link for the latest forecast, we can download the file (zip file) and unzip.</p>
<ul>
<li><p>The unzipped folder contains shapefiles files for tornado,wind, and hail threat, but I will focus on just the categorical risk for severe thunderstorms (this is what you have probably seen on the weather forecast on the news). The shapfile I am interested in ends in <em>cat.shp</em></p></li>
<li><p>Then we can use the <em>sf</em> <span class="citation" data-cites="sf">(<a href="#ref-sf" role="doc-biblioref">Pebesma 2018</a>)</span> package to read the shapefile into R</p></li>
</ul>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># destination to save downloaded file to</span></span>
<span><span class="va">dest_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'.'</span>,<span class="st">'data'</span>,<span class="va">shp_fname</span><span class="op">)</span></span>
<span><span class="co"># download the zip file containing shapefiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url<span class="op">=</span><span class="va">shp_url</span>,destfile <span class="op">=</span> <span class="va">dest_file</span>, method<span class="op">=</span><span class="st">"curl"</span>,quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unzip into a separate folder using base filename</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="va">dest_file</span>,exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'.'</span>,<span class="st">'data'</span>,<span class="va">basefname</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># read shapefile into R w/ sf package</span></span>
<span><span class="va">cat_file</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">shp_url</span><span class="op">)</span>,<span class="st">"-shp.zip"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">'.'</span>,<span class="st">'data'</span>,<span class="va">basefname</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">basefname</span>,<span class="st">'_cat.shp'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Reading layer `day1otlk_20230706_1300_cat' from data source 
  `/Users/andy/Projects/Andy_Pickering_Portfolio/posts/Storm_Prediction_Center/data/day1otlk_20230706_1300/day1otlk_20230706_1300_cat.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 4 features and 8 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -123.85 ymin: 24.169 xmax: -67.471 ymax: 49.561
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>Examine the object extracted from the shapefile:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 8 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -123.85 ymin: 24.169 xmax: -67.471 ymax: 49.561
Geodetic CRS:  WGS 84
  DN        VALID       EXPIRE        ISSUE LABEL                     LABEL2
1  2 202307061300 202307071200 202307061244  TSTM General Thunderstorms Risk
2  3 202307061300 202307071200 202307061244  MRGL              Marginal Risk
3  4 202307061300 202307071200 202307061244  SLGT                Slight Risk
4  5 202307061300 202307071200 202307061244   ENH              Enhanced Risk
   stroke    fill                       geometry
1 #55BB55 #C1E9C1 POLYGON ((-92.46012 48.6844...
2 #005500 #66A366 POLYGON ((-109.69 47.18, -1...
3 #DDAA00 #FFE066 POLYGON ((-105.19 45.5, -10...
4 #FF6600 #FFA366 POLYGON ((-102.51 39.91, -9...</code></pre>
</div>
</div>
</section></section><section id="mapping-the-data" class="level1"><h1>Mapping the data</h1>
<p>Now that we have the shapefile converted into a R object, we can make our map. I’ll be using the <em>Leaflet</em> <span class="citation" data-cites="leaflet">(<a href="#ref-leaflet" role="doc-biblioref">Cheng, Karambelkar, and Xie 2023</a>)</span> package to create a nice interactive map.</p>
<ul>
<li>One caveat is that the number of categories is not constant; it can vary (up to 5 categorgies) depending on the forecast. So we need to use a for loop to plot whichever categories are present (there is a row in the sf object for each risk category present in the forecast.</li>
<li>We now have an interactive map (try zooming in/out and hovering over the different areas with the cursor!).</li>
<li><em>NOTE this map is for the forecast at the time this post was rendered, not when you are reading it</em></li>
</ul>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#| fig-cap: Map Showing Severe Weather Prediction Risk</span></span>
<span></span>
<span><span class="co"># extract bounding box values from shapefile to set map bounds</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make base map</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add layers (1 for each risk category present in forecast)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span><span class="op">(</span>map <span class="op">=</span> <span class="va">m</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">geometry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                 color<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">fill</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                 label <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">LABEL2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html">setMaxBounds</a></span><span class="op">(</span>lng1 <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">xmin</span>,lng2 <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">xmax</span>,lat1 <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">ymin</span>, lat2<span class="op">=</span><span class="va">bb</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">LABEL2</span>,colors <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">fill</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cb5a84f3b61ba3bade7e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cb5a84f3b61ba3bade7e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addPolygons","args":[[[[{"lng":[-92.46011869436202,-92.92,-94.19,-95.73999999999999,-97.89,-99.84,-101.48,-104.79,-108.83,-108.06,-106.15,-102.98,-99.20999999999999,-96.2,-95.38,-94.81,-94.45,-93.13,-90.62,-89.20999999999999,-87.95,-86.88,-86.09999999999999,-86.09999999999999,-85.95,-84.22237692318326,-84.03400000000001,-83.88,-83.81399999999999,-83.74299999999999,-83.601,-83.414,-83.251,-83.288,-83.292,-82.232,-81.965,-81.902,-82.087,-82.07299999999999,-82.196,-82.304,-82.518,-82.69,-82.863,-82.90300000000001,-82.863,-82.80800000000001,-82.68899999999999,-82.459,-81.764,-81.262,-80.316,-79.514,-79.252,-79.373,-78.63200000000001,-77.319,-76.955,-76.557,-75.977,-75.60299999999999,-74.881,-71.70999999999999,-71.571,-70.99299999999999,-70.611,-70.553,-70.214,-69.33799999999999,-68.819,-68.687,-68.509,-68.217,-67.636,-67.471,-67.49210693690162,-68.29000000000001,-69.90000000000001,-70.39,-70.5,-71.56,-74,-74.24135435929193,-74.372,-74.504,-74.71599999999999,-74.70099999999999,-74.762,-75.086,-75.26300000000001,-75.35599999999999,-75.645,-75.371,-75.12,-75.166,-75.279,-75.429,-75.726,-76.265,-76.54000000000001,-76.776,-76.93600000000001,-77.521,-77.684,-77.95,-78.163,-78.569,-78.80800000000001,-78.931,-79.294,-79.72499999999999,-80.06100000000001,-80.20999999999999,-80.43600000000001,-80.764,-81.09,-80.989,-80.765,-80.349,-80.197,-80.271,-79.788,-79.7,-79.76600000000001,-79.812,-79.965,-80.143,-80.331,-80.63500000000001,-81.054,-81.782,-82.816,-83.288,-83.28,-83.238,-83.163,-82.313,-82.36799999999999,-82.51000000000001,-82.63200000000001,-81.934,-82.143,-82.324,-82.535,-82.71899999999999,-83.105,-83.06999999999999,-83.18300000000001,-83.185,-83.15600000000001,-83.014,-82.98999999999999,-83.026,-83.273,-83.42100000000001,-83.625,-83.895,-84.07299999999999,-84.17100000000001,-84.467,-85.018,-85.336,-85.675,-85.767,-85.985,-86.462,-87.771,-88.40600000000001,-88.432,-88.69499999999999,-88.581,-88.619,-88.937,-89.175,-89.399,-89.712,-89.828,-90.102,-90.54000000000001,-90.745,-91.083,-91.315,-91.556,-91.655,-91.742,-92.07899999999999,-92.164,-92.629,-93.24299999999999,-93.58799999999999,-93.777,-93.961,-94.26600000000001,-94.502,-94.90000000000001,-95.134,-95.489,-96.044,-96.14700000000001,-96.42700000000001,-96.79600000000001,-97.017,-96.876,-96.749,-97.075,-97.23,-97.68000000000001,-98.218,-98.509,-99.10299999999999,-99.357,-99.489,-99.61199999999999,-99.697,-99.724,-99.917,-100.23,-100.41,-100.596,-100.754,-100.911,-101.161,-101.2590706802811,-99.52,-100.19,-101.67,-103.32,-104.01,-104.2543521876717,-104.636,-104.879,-104.926,-105.115,-105.605,-106.064,-106.509,-106.568,-107.183,-107.571792607652,-107.51,-106.24,-105.36,-105.83,-107.72,-109.38,-110.75,-111.51,-116.05,-117.82,-120.37,-122.65,-123.47,-123.85,-122.41,-121.14,-118.33,-117.48,-118.25,-119.94,-120.89,-121.83,-122.69,-123.3211863593574,-123.29,-123.111,-122.837,-122.534,-121.576,-120.445,-119.226,-117.702,-116.063,-114.53,-113.003,-111.288,-109.98,-109.426,-108.987,-107.292,-105.669,-103.614,-101.067,-99.664,-98.264,-96.747,-95.911,-95.453,-95.48999999999999,-94.57899999999999,-94.395,-93.80500000000001,-93.51300000000001,-93.223,-92.5,-92.46011869436202],"lat":[48.68446587537093,48.46,47.99,47.67,47.58,47.84,48.32,48.79,48.36,47.66,47.46,47.35,46.35,45.16,43.46,41.26,38.96,37.8,37.37,37.54,38.33,39.66,41,42.36,43.71,46.69251347092244,46.687,46.326,46.264,46.252,46.229,46.232,46.093,45.851,45.799,45.499,44.144,43.586,43.18,43.025,42.879,42.546,42.326,42.224,42.181,42.063,41.98,41.911,41.863,41.878,42.178,42.421,42.6,42.795,42.966,43.553,43.794,43.789,43.791,44.256,44.604,44.874,45.189,45.171,45.456,45.547,45.956,46.207,46.804,47.646,47.584,47.517,47.491,47.605,47.183,46.578,46.04283701920385,45.8,44.15,42.98,41.79,41.27,40.62,39.0803256389998,38.982,38.814,38.67,38.442,38.239,37.666,37.548,37.334,36.894,36.199,35.649,35.243,34.984,34.931,34.857,34.375,34.248,34.354,34.358,34.032,33.615,33.516,33.577,33.483,33.309,32.928,32.69,32.427,32.203,32.07,31.966,31.633,30.74,30.128,29.498,28.83,28.552,28.232,27.148,26.777,26.228,25.576,25.158,24.859,24.705,24.487,24.361,24.208,24.169,24.221,24.513,24.798,25.012,25.017,25.134,25.288,25.453,25.61,26.09,26.171,26.48,26.892,27.532,27.615,27.781,28.105,28.373,28.465,28.551,28.753,28.827,29.093,29.29,29.642,29.73,29.626,29.438,29.246,29.335,29.436,29.696,29.876,30.068,29.878,29.863,29.714,29.394,29.249,29.022,28.691,28.63,28.577,28.693,28.916,28.755,28.711,28.711,28.732,28.893,28.983,29.121,29.058,29.114,29.181,29.233,29.441,29.43,29.35,29.348,29.222,29.062,28.808,28.597,28.428,28.182,28.055,27.94,27.579,27.081,26.595,25.948,25.799,25.659,25.837,25.934,26.039,26.254,26.519,26.804,27.039,27.291,27.496,27.637,28.008,28.265,28.593,28.844,29.059,29.268,29.35283622861689,31.69,32.89,32.94,32.29,31.16,29.31471968620317,29.554,29.863,30.211,30.476,30.822,31.194,31.409,31.573,31.602,31.61445243227355,32.61,34.57,36.61,37.96,39.05,39.66,39.91,40.47,40.06,40.76,40.12,39.96,40.45,41.85,44.03,45.16,45.86,46.24,46.97,47.09,46.55,46.65,47.41,49.16411092891197,49.187,49.134,49.303,49.247,49.18,49.201,49.203,49.217,49.223,49.22,49.227,49.211,49.207,49.192,49.202,49.194,49.171,49.188,49.197,49.183,49.18,49.197,49.174,49.167,49.561,49.541,48.962,48.857,48.786,48.834,48.697,48.68446587537093]},{"lng":[-109.69,-111.06,-111.57,-111.55,-110.46,-108.56,-107.52,-106.38,-105,-105.45,-105.35,-104.99,-103.82,-102.86,-101.62,-99.61,-96.87,-95.36,-93.93000000000001,-92.78,-91.28,-90.17,-90.04000000000001,-91.33,-92.59,-93.29000000000001,-94.48,-96.06999999999999,-97.12,-99.13,-100.26,-105.81,-109.69],"lat":[47.18,47.17,46.71,45.72,44.33,43.6,41.83,39.79,36.92,34.26,33.16,32.58,32.65,33.17,34.41,33.89,33.5,32.14,31.4,31.02,31.25,31.63,32.5,33.51,36.07,36.69,37.81,39.85,42.19,44.75,45.33,46.4,47.18]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#C1E9C1","weight":5,"opacity":0.5,"fill":true,"fillColor":"#C1E9C1","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"General Thunderstorms Risk",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolygons","args":[[[[{"lng":[-109.69,-105.81,-100.26,-99.13,-97.12,-96.06999999999999,-94.48,-93.29000000000001,-92.59,-91.33,-90.04000000000001,-90.17,-91.28,-92.78,-93.93000000000001,-95.36,-96.87,-99.61,-101.62,-102.86,-103.82,-104.99,-105.35,-105.45,-105,-106.38,-107.52,-108.56,-110.46,-111.55,-111.57,-111.06,-109.69],"lat":[47.18,46.4,45.33,44.75,42.19,39.85,37.81,36.69,36.07,33.51,32.5,31.63,31.25,31.02,31.4,32.14,33.5,33.89,34.41,33.17,32.65,32.58,33.16,34.26,36.92,39.79,41.83,43.6,44.33,45.72,46.71,47.17,47.18]},{"lng":[-105.19,-105.27,-107.24,-108.53,-108.38,-106.83,-105.27,-104.91,-104.11,-102.43,-99.06,-97.84999999999999,-96.90000000000001,-96.79000000000001,-98.14,-99.26000000000001,-100.48,-102.43,-105.17,-105.19],"lat":[45.5,45.52,45.39,44.96,44.47,41.27,38.67,37.43,35.82,35.31,35.49,35.71,36.23,36.87,39.37,41.2,42.52,45.1,45.5,45.5]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#66A366","weight":5,"opacity":0.5,"fill":true,"fillColor":"#66A366","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Marginal Risk",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolygons","args":[[[[{"lng":[-105.19,-105.17,-102.43,-100.48,-99.26000000000001,-98.14,-96.79000000000001,-96.90000000000001,-97.84999999999999,-99.06,-102.43,-104.11,-104.91,-105.27,-106.83,-108.38,-108.53,-107.24,-105.27,-105.19],"lat":[45.5,45.5,45.1,42.52,41.2,39.37,36.87,36.23,35.71,35.49,35.31,35.82,37.43,38.67,41.27,44.47,44.96,45.39,45.52,45.5]},{"lng":[-102.51,-103.48,-104.71,-105.1,-104.96,-104.53,-103.46,-102.15,-100.36,-99.37,-98.86,-98.64,-98.84999999999999,-99.59999999999999,-102.51],"lat":[39.91,40.09,40.08,39.72,38.66,37.38,37,37.03,36.71,36.42,36.49,37.16,37.86,38.59,39.91]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#FFE066","weight":5,"opacity":0.5,"fill":true,"fillColor":"#FFE066","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Slight Risk",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolygons","args":[[[[{"lng":[-102.51,-99.59999999999999,-98.84999999999999,-98.64,-98.86,-99.37,-100.36,-102.15,-103.46,-104.53,-104.96,-105.1,-104.71,-103.48,-102.51],"lat":[39.91,38.59,37.86,37.16,36.49,36.42,36.71,37.03,37,37.38,38.66,39.72,40.08,40.09,39.91]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#FFA366","weight":5,"opacity":0.5,"fill":true,"fillColor":"#FFA366","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Enhanced Risk",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"setMaxBounds","args":[24.169,-123.85,49.561,-67.471]},{"method":"addLegend","args":[{"colors":["#C1E9C1","#66A366","#FFE066","#FFA366"],"labels":["General Thunderstorms Risk","Marginal Risk","Slight Risk","Enhanced Risk"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"unknown","title":null,"extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[24.169,49.561],"lng":[-123.85,-67.471]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="sessioninfo" class="level1"><h1>SessionInfo</h1>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.3 (2023-03-15)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
[1] htmltools_0.5.5 stringr_1.5.0   rvest_1.0.3     leaflet_2.1.2  
[5] sf_1.0-13      

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.10        compiler_4.2.3     pillar_1.9.0       class_7.3-22      
 [5] tools_4.2.3        digest_0.6.31      jsonlite_1.8.5     evaluate_0.21     
 [9] lifecycle_1.0.3    tibble_3.2.1       pkgconfig_2.0.3    rlang_1.1.1       
[13] DBI_1.1.3          cli_3.6.1          rstudioapi_0.14    crosstalk_1.2.0   
[17] curl_5.0.1         yaml_2.3.7         xfun_0.39          fastmap_1.1.1     
[21] e1071_1.7-13       xml2_1.3.4         httr_1.4.6         dplyr_1.1.2       
[25] knitr_1.43         generics_0.1.3     vctrs_0.6.2        htmlwidgets_1.6.2 
[29] classInt_0.4-9     grid_4.2.3         tidyselect_1.2.0   glue_1.6.2        
[33] R6_2.5.1           fansi_1.0.4        rmarkdown_2.22     selectr_0.4-2     
[37] magrittr_2.0.3     ellipsis_0.3.2     units_0.8-2        renv_0.17.3       
[41] KernSmooth_2.23-21 utf8_1.2.3         stringi_1.7.12     proxy_0.4-27      </code></pre>
</div>
</div>


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-leaflet" class="csl-entry" role="listitem">
Cheng, Joe, Bhaskar Karambelkar, and Yihui Xie. 2023. <span>“Leaflet: Create Interactive Web Maps with the JavaScript ’Leaflet’ Library.”</span> <a href="https://CRAN.R-project.org/package=leaflet">https://CRAN.R-project.org/package=leaflet</a>.
</div>
<div id="ref-sf" class="csl-entry" role="listitem">
Pebesma, Edzer. 2018. <span>“<span></span>Simple Features for r: Standardized Support for Spatial Vector Data<span></span>”</span> 10. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-rvest" class="csl-entry" role="listitem">
Wickham, Hadley. 2022. <span>“Rvest: Easily Harvest (Scrape) Web Pages.”</span> <a href="https://CRAN.R-project.org/package=rvest">https://CRAN.R-project.org/package=rvest</a>.
</div>
</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Mapping Severe Thunderstorm Outlook in R using Leaflet"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> image.jpg</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-06-29"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [weather, R, visualization, mapping, geospatial, leaflet]</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "2023-07-06"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>Living on the Colorado front range in summer means dealing with a chance of thunderstorms almost every afternoon, some of which can become severe.</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>In this post I'll go over how I mapped the severe thunderstorm risk outlook from the <span class="co">[</span><span class="ot">NOAA Storm Prediction Center</span><span class="co">](https://www.spc.noaa.gov/misc/aboutus.html)</span> , using R and leaflet.</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Load Libraries}</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(sf))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>The day 1 (ie today) severe thunderstorm risk (<span class="co">[</span><span class="ot">Convective Outlook</span><span class="co">](https://www.spc.noaa.gov/misc/about.html)</span>) can be found at the website: <span class="co">[</span><span class="ot">NOAA Storm Prediction Center</span><span class="co">](https://www.spc.noaa.gov/products/outlook/day1otlk.html)</span> . This website provides a map where you can toggle a bunch of layers on/off, but you cannot zoom in/out to get a more detailed view of where the warning areas fall relative to other non-major cities. Depending on where the risk falls, it can sometimes be difficult to tell exactly where the boundaries are, or what category your home town is in. My goal was to try to view the data in an interactive map where I can zoom in/out and see more detail. There are 2 ways of doing this:</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>View the data in Google Earth: Above the map there is an icon you can click to download a kmz file that can be opened in Google Earth.</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Download the data as shapefiles (a link is provided above the map next to the kml download) and process them into a map.</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>In this post I am focusing on working with the shapefiles and creating an interactive map using R and leaflet.</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Downloading the data</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>The shapefiles can be downloaded manually by clicking the link on the website, but the link changes whenever the forecast is updated. I wanted to do this in a more programmatic way and be able to automatically find the link for the latest forecast without having to manually copy and paste the link each time I run it. I experimented with using the <span class="co">[</span><span class="ot">SelectorGadget</span><span class="co">](https://rvest.tidyverse.org/articles/selectorgadget.html)</span> to isolate the link, but found it easier to create a list of all the links in the page using the *rvest* [@rvest] package and then find the link containing the shapefile (ends in *.shp.zip*).</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://www.spc.noaa.gov"</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to make a list of all links on a webpage</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>get_all_links <span class="ot">&lt;-</span> <span class="cf">function</span>(page_url){</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read the html from the website for day 1 outlook</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  html <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(page_url)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a list of all the hyperlinks on the website</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  links <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">html_attr</span>(<span class="fu">html_nodes</span>(html, <span class="st">"a"</span>), <span class="st">"href"</span>)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">get_all_links</span>(<span class="at">page_url=</span><span class="fu">paste0</span>(base_url,<span class="st">"/products/outlook/day1otlk.html"</span>))</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="co"># find the link for the shapefile (they only one that ends in 'shp.zip') </span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>shp_link <span class="ot">&lt;-</span> links[<span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_ends</span>(links,<span class="st">'shp.zip'</span>))]</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>shp_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url,shp_link)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">'The latest shapefile as of '</span>,<span class="fu">Sys.time</span>(),<span class="st">' is '</span>,shp_url))</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co"># filename of shapefile</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>shp_fname <span class="ot">&lt;-</span> <span class="fu">basename</span>(shp_url)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="co">#print(shp_fname)</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="co"># base filename (remove *-shp.zip*) to use to load files later</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>basefname <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(shp_fname,<span class="st">"-shp.zip"</span>)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co">#print(basefname)</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>Now that we have the link for the latest forecast, we can download the file (zip file) and unzip.</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The unzipped folder contains shapefiles files for tornado,wind, and hail threat, but I will focus on just the categorical risk for severe thunderstorms (this is what you have probably seen on the weather forecast on the news). The shapfile I am interested in ends in *cat.shp*</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Then we can use the *sf* <span class="co">[</span><span class="ot">@sf</span><span class="co">]</span> package to read the shapefile into R</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="co"># destination to save downloaded file to</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">'.'</span>,<span class="st">'data'</span>,shp_fname)</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="co"># download the zip file containing shapefiles</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url=</span>shp_url,<span class="at">destfile =</span> dest_file, <span class="at">method=</span><span class="st">"curl"</span>,<span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="co"># unzip into a separate folder using base filename</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(dest_file,<span class="at">exdir =</span> <span class="fu">file.path</span>(<span class="st">'.'</span>,<span class="st">'data'</span>,basefname) )</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="co"># read shapefile into R w/ sf package</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>cat_file <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="fu">basename</span>(shp_url),<span class="st">"-shp.zip"</span>)</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="fu">file.path</span>(<span class="st">'.'</span>,<span class="st">'data'</span>,basefname,<span class="fu">paste0</span>(basefname,<span class="st">'_cat.shp'</span>)))</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>Examine the object extracted from the shapefile:</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat)</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mapping the data</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>Now that we have the shapefile converted into a R object, we can make our map. I'll be using the *Leaflet* <span class="co">[</span><span class="ot">@leaflet</span><span class="co">]</span> package to create a nice interactive map.</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>One caveat is that the number of categories is not constant; it can vary (up to 5 categorgies) depending on the forecast. So we need to use a for loop to plot whichever categories are present (there is a row in the sf object for each risk category present in the forecast.</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We now have an interactive map (try zooming in/out and hovering over the different areas with the cursor!).</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*NOTE this map is for the forecast at the time this post was rendered, not when you are reading it*</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Map Showing Severe Weather Prediction Risk</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="co"># extract bounding box values from shapefile to set map bounds</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">st_bbox</span>(dat))</span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="co"># make base map</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>      <span class="fu">addTiles</span>()</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a><span class="co"># add layers (1 for each risk category present in forecast)</span></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dat<span class="sc">$</span>geometry)){</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">addPolygons</span>(<span class="at">map =</span> m, <span class="at">data =</span> dat<span class="sc">$</span>geometry[i],</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span>dat<span class="sc">$</span>fill[i],</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> dat<span class="sc">$</span>LABEL2[i])  </span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setMaxBounds</span>(<span class="at">lng1 =</span> bb<span class="sc">$</span>xmin,<span class="at">lng2 =</span> bb<span class="sc">$</span>xmax,<span class="at">lat1 =</span> bb<span class="sc">$</span>ymin, <span class="at">lat2=</span>bb<span class="sc">$</span>ymax) <span class="sc">%&gt;%</span> </span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(<span class="at">labels=</span>dat<span class="sc">$</span>LABEL2,<span class="at">colors =</span> dat<span class="sc">$</span>fill)</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="fu"># SessionInfo</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>